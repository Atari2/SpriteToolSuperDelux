cmake_minimum_required(VERSION 3.10)
project(pixi VERSION 1.32)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)
add_executable(pixi src/icon.rc src/cfg.cpp src/file_io.cpp src/json.cpp src/map16.cpp src/paths.cpp src/sprite.cpp src/structs.cpp src/MeiMei/MeiMei.cpp src/asar/asardll.c src/json/base64.cpp)
if (CMAKE_COMPILER_IS_GNUCXX)
    if (WIN32)
        message(STATUS "Windows build, adding static libraries")
        if (CMAKE_BUILD_TYPE STREQUAL "Debug")  # if debug mode, don't add -s and --gc-sections
            message(STATUS "Building debug mode")
            target_link_options(pixi PRIVATE -m32 -static) 
        else()
            message(STATUS "Building release mode")
            target_link_options(pixi PRIVATE -m32 -static -s -Wl,--gc-sections)
        endif()
        target_link_libraries(pixi PRIVATE -static-libgcc -static-libstdc++)
        target_compile_options(pixi PRIVATE -m32 -Wall -Wextra -Wpedantic)
    else()
        message(STATUS "Unix build, not adding static libraries")   # on unix we don't care about -m32, for... some reason I guess
        if (CMAKE_BUILD_TYPE STREQUAL "Debug")
            message(STATUS "Building debug mode")
        else()
            message(STATUS "Building release mode")
            target_link_options(pixi PRIVATE -s -Wl,--gc-sections)
        endif()
        target_link_libraries(pixi PRIVATE dl)
        target_compile_options(pixi PRIVATE -Wall -Wextra -Wpedantic)
    endif() 
    message(STATUS "GCC detected, adding compile flags")
else()
    set(CMAKE_GENERATOR "Visual Studio 16 2019")
    set(CMAKE_GENERATOR_PLATFORM Win32 CACHE INTERNAL "")
    set(CMAKE_VS_PLATFORM_NAME Win32 CACHE INTERNAL "")
    target_link_options(pixi PRIVATE /INCREMENTAL:NO /NODEFAULTLIB:MSVCRT)
    message(STATUS "MSVC detected, adding compile flags")
    target_compile_options(pixi PRIVATE /O2 /MT /w /std:c++17) ## we disable all warnings just cause there's like 5000 and they are noisy, we only care about gcc's warnings anyway
endif()
